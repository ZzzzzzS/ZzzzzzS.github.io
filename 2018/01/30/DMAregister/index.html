<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>kinetis KV58 DMA模块食用指南 | ZzzzzzS Home</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="嵌入式,微控制器,单片机,NXP,Kinetis,STM32,Linux,FPGA,DSP,物联网"><meta name="description" content="日常学习与兴趣交流的个人博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://blog.zzshub.cn/2018/01/30/DMAregister/index.html"><link rel="icon" type="image/png" href="http://zzshubimage-1253829354.cosbj.myqcloud.com/blog/logo.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="ZZS"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(http://zzshubimage-1253829354.cosbj.myqcloud.com/blog/loading.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="ZZS" alt="ZZS"><img src="http://zzshubimage-1253829354.cosbj.myqcloud.com/blog/ZZSLOGO.png" alt="ZZS"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89999%E5%9B%BE.png" alt="kinetis KV58 DMA模块食用指南"></div><header class="post__info"><h1 class="post__title">kinetis KV58 DMA模块食用指南</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="http://zzzzzzs.github.io/">ZZS</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-01-30</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/ARM/">ARM</a></li><li class="mark__item"><a href="/tags/kinetis/">Kinetis</a></li><li class="mark__item"><a href="/tags/register/">Register</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><h1 id="NXP-Kinetis系列-KV58微控制器DMA模块食用指南"><a href="#NXP-Kinetis系列-KV58微控制器DMA模块食用指南" class="headerlink" title="NXP Kinetis系列 KV58微控制器DMA模块食用指南"></a>NXP Kinetis系列 KV58微控制器DMA模块食用指南</h1><blockquote><p>本文主要以KV58为例介绍kinetis系列微控制器的DMA模块的寄存器以及配置方法.</p></blockquote><h1 id="DMA是什么"><a href="#DMA是什么" class="headerlink" title="DMA是什么"></a>DMA是什么</h1><p>DMA全称直接内存访问(Direct Memory Access).是所有现代电脑的重要特色，它允许不同速度的硬件装置来沟通,而不需要依赖于 CPU 的大量中断负载.工作过程中不需要CPU干预,也不需要像中断处理方式那样需要保留现场,恢复现场之类的麻烦事,简单理解为一条直接连通外设与RAM的硬件通道,所以DMA技术可以提高系统运行效率（即CPU可以干其他的事去,算是一种简单的并行模式吧）.关于更多DMA的说明这里就不再多说,可以参考参考百度百科的说明<a href="https://baike.baidu.com/item/DMA/2385376?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/DMA/2385376?fr=aladdin</a></p><h1 id="Kinetis的DMA"><a href="#Kinetis的DMA" class="headerlink" title="Kinetis的DMA"></a>Kinetis的DMA</h1><p>对于kinetis来说,DMA主要分为两大模块</p><ul><li><strong>DMAMUX</strong> 直接内存访问多路复用器(Direct Memory Access Multiplexer)</li><li><strong>eDMA</strong> 直接内存访问控制器(Enhanced Direct Memory Access)</li></ul><p>DMAMUX实质上是一个矩阵开关,负责将DMA的触发源映射到对应的DMA通道中.而eDMA才是真正搬运数据的模块,可以看到,kinetis的DMA前多了个<strong>e</strong>,代表Enhanced增强型.从这里也可以看出kinetis系列DMA的强大和灵活了.eDMA模块下又主要分为了两大部分: TCD传输控制器(Transfer Control Descriptor)用于控制每个通道的传输情况以及DMA引擎(eDMA engine)用于控制整个DMA引擎的状态,如下图所示 (<a href="https://www.nxp.com/docs/en/reference-manual/KV5XP144M240RM.pdf" target="_blank" rel="noopener">摘自<strong>KV5x Sub-Family Reference Manual</strong> Page 486 </a>):</p><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89%E5%9B%BE.png" alt=""></p><p>DMA是如何搬运数据的可以用一下流程图来描述:</p><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/6374029876143.jpg" alt=""></p><p>如图所示,DMA触发源先经过DMAMUX将源分配到不同的DMA通道上,不同的DMA通道根据TCD寄存器的配置来将数据从源地址搬运到目标地址.那么这样来看,配置寄存器主要就分为以下几个步骤:</p><ul><li>打开有关的时钟(DMAMUX,eDMA,其他用到的模块如SPI的时钟)</li><li>配置DMAMUX触发源</li><li>配置eDMA引擎相关寄存器</li><li>配置TCD传输相关寄存器</li><li>打开相关外设的DMA使能</li><li>打开DMA中断等,开始DMA传输</li></ul><h1 id="DMAMUX模块"><a href="#DMAMUX模块" class="headerlink" title="DMAMUX模块"></a>DMAMUX模块</h1><p>前面说到DMAMUX是配置触发源到DMA通道,KV58微控制器有64个触发源,32个DMA通道.64个触发源如下(摘自CMSIS MKV58F24.h):</p><h2 id="DMAMUX触发源"><a href="#DMAMUX触发源" class="headerlink" title="DMAMUX触发源"></a>DMAMUX触发源</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> _dma_request_source</span><br><span class="line">&#123;</span><br><span class="line">    kDmaRequestMux0Disable          = <span class="number">0</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; DMAMUX TriggerDisabled. */</span></span><br><span class="line">    kDmaRequestMux0Reserved1        = <span class="number">1</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; Reserved1 */</span></span><br><span class="line">    kDmaRequestMux0UART0Rx          = <span class="number">2</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; UART0 Receive. */</span></span><br><span class="line">    kDmaRequestMux0UART0Tx          = <span class="number">3</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; UART0 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0UART1Rx          = <span class="number">4</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; UART1 Receive. */</span></span><br><span class="line">    kDmaRequestMux0UART1Tx          = <span class="number">5</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; UART1 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0PWM0WR0          = <span class="number">6</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; PWM0 Write Request 0. */</span></span><br><span class="line">    kDmaRequestMux0PWM0WR1          = <span class="number">7</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; PWM0 Write Request 1. */</span></span><br><span class="line">    kDmaRequestMux0PWM0WR2          = <span class="number">8</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; PWM0 Write Request 2. */</span></span><br><span class="line">    kDmaRequestMux0PWM0WR3          = <span class="number">9</span>|<span class="number">0x100</span>U,    <span class="comment">/**&lt; PWM0 Write Request 3. */</span></span><br><span class="line">    kDmaRequestMux0PWM0CP0          = <span class="number">10</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PWM0 Capture 0. */</span></span><br><span class="line">    kDmaRequestMux0PWM0CP1          = <span class="number">11</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PWM0 Capture 1. */</span></span><br><span class="line">    kDmaRequestMux0PWM0CP2          = <span class="number">12</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PWM0 Capture 2. */</span></span><br><span class="line">    kDmaRequestMux0PWM0CP3          = <span class="number">13</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PWM0 Capture 3. */</span></span><br><span class="line">    kDmaRequestMux0CAN0             = <span class="number">14</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; CAN0. */</span></span><br><span class="line">    kDmaRequestMux0CAN1             = <span class="number">15</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; CAN1. */</span></span><br><span class="line">    kDmaRequestMux0SPI0Rx           = <span class="number">16</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; SPI0 Receive. */</span></span><br><span class="line">    kDmaRequestMux0SPI0Tx           = <span class="number">17</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; SPI0 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0XBARAOUT0        = <span class="number">18</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; XBARA Output 0. */</span></span><br><span class="line">    kDmaRequestMux0XBARAOUT1        = <span class="number">19</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; XBARA Output 1. */</span></span><br><span class="line">    kDmaRequestMux0XBARAOUT2        = <span class="number">20</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; XBARA Output 2. */</span></span><br><span class="line">    kDmaRequestMux0XBARAOUT3        = <span class="number">21</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; XBARA Output 3. */</span></span><br><span class="line">    kDmaRequestMux0I2C0             = <span class="number">22</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; I2C0. */</span></span><br><span class="line">    kDmaRequestMux0Reserved23       = <span class="number">23</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; Reserved23 */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel0     = <span class="number">24</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C0V. */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel1     = <span class="number">25</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C1V. */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel2     = <span class="number">26</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C2V. */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel3     = <span class="number">27</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C3V. */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel4     = <span class="number">28</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C4V. */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel5     = <span class="number">29</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C5V. */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel6     = <span class="number">30</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C6V. */</span></span><br><span class="line">    kDmaRequestMux0FTM0Channel7     = <span class="number">31</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM0 C7V. */</span></span><br><span class="line">    kDmaRequestMux0FTM1Channel0     = <span class="number">32</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM1 C0V. */</span></span><br><span class="line">    kDmaRequestMux0FTM1Channel1     = <span class="number">33</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM1 C1V. */</span></span><br><span class="line">    kDmaRequestMux0CMP3             = <span class="number">34</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; CMP3. */</span></span><br><span class="line">    kDmaRequestMux0Reserved35       = <span class="number">35</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; Reserved35 */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel0     = <span class="number">36</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C0V. */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel1     = <span class="number">37</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C1V. */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel2     = <span class="number">38</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C2V. */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel3     = <span class="number">39</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C3V. */</span></span><br><span class="line">    kDmaRequestMux0HSADC0A          = <span class="number">40</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; HSADC0. */</span></span><br><span class="line">    kDmaRequestMux0HSADC0B          = <span class="number">41</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; HSADC0. */</span></span><br><span class="line">    kDmaRequestMux0CMP0             = <span class="number">42</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; CMP0. */</span></span><br><span class="line">    kDmaRequestMux0CMP1             = <span class="number">43</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; CMP1. */</span></span><br><span class="line">    kDmaRequestMux0CMP2             = <span class="number">44</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; CMP2. */</span></span><br><span class="line">    kDmaRequestMux0DAC0             = <span class="number">45</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; DAC0. */</span></span><br><span class="line">    kDmaRequestMux0Reserved46       = <span class="number">46</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; Reserved46 */</span></span><br><span class="line">    kDmaRequestMux0PDB1             = <span class="number">47</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PDB1. */</span></span><br><span class="line">    kDmaRequestMux0PDB0             = <span class="number">48</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PDB0. */</span></span><br><span class="line">    kDmaRequestMux0PortA            = <span class="number">49</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PTA. */</span></span><br><span class="line">    kDmaRequestMux0PortB            = <span class="number">50</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PTB. */</span></span><br><span class="line">    kDmaRequestMux0PortC            = <span class="number">51</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PTC. */</span></span><br><span class="line">    kDmaRequestMux0PortD            = <span class="number">52</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PTD. */</span></span><br><span class="line">    kDmaRequestMux0PortE            = <span class="number">53</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; PTE. */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel4     = <span class="number">54</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C4V. */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel5     = <span class="number">55</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C5V. */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel6     = <span class="number">56</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C6V. */</span></span><br><span class="line">    kDmaRequestMux0FTM3Channel7     = <span class="number">57</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; FTM3 C7V. */</span></span><br><span class="line">    kDmaRequestMux0Reserved58       = <span class="number">58</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; Reserved58 */</span></span><br><span class="line">    kDmaRequestMux0Reserved59       = <span class="number">59</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; Reserved59 */</span></span><br><span class="line">    kDmaRequestMux0AlwaysOn60       = <span class="number">60</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">    kDmaRequestMux0AlwaysOn61       = <span class="number">61</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">    kDmaRequestMux0AlwaysOn62       = <span class="number">62</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">    kDmaRequestMux0AlwaysOn63       = <span class="number">63</span>|<span class="number">0x100</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">    kDmaRequestMux0Group1Disable    = <span class="number">0</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; DMAMUX TriggerDisabled. */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved1  = <span class="number">1</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; Reserved1 */</span></span><br><span class="line">    kDmaRequestMux0Group1UART2Rx    = <span class="number">2</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; UART2 Receive. */</span></span><br><span class="line">    kDmaRequestMux0Group1UART2Tx    = <span class="number">3</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; UART2 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0Group1UART3Rx    = <span class="number">4</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; UART3 Receive. */</span></span><br><span class="line">    kDmaRequestMux0Group1UART3Tx    = <span class="number">5</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; UART3 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1WR0    = <span class="number">6</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; PWM1 Write Request 0. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1WR1    = <span class="number">7</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; PWM1 Write Request 1. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1WR2    = <span class="number">8</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; PWM1 Write Request 2. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1WR3    = <span class="number">9</span>|<span class="number">0x200</span>U,    <span class="comment">/**&lt; PWM1 Write Request 3. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1CP0    = <span class="number">10</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; PWM1 Capture 0. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1CP1    = <span class="number">11</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; PWM1 Capture 1. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1CP2    = <span class="number">12</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; PWM1 Capture 2. */</span></span><br><span class="line">    kDmaRequestMux0Group1PWM1CP3    = <span class="number">13</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; PWM1 Capture 3. */</span></span><br><span class="line">    kDmaRequestMux0Group1CAN2       = <span class="number">14</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; CAN2. */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved15 = <span class="number">15</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved15 */</span></span><br><span class="line">    kDmaRequestMux0Group1SPI1Rx     = <span class="number">16</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; SPI1 Receive. */</span></span><br><span class="line">    kDmaRequestMux0Group1SPI1Tx     = <span class="number">17</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; SPI1 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved18 = <span class="number">18</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved18 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved19 = <span class="number">19</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved19 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved20 = <span class="number">20</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved20 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved21 = <span class="number">21</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved21 */</span></span><br><span class="line">    kDmaRequestMux0Group1I2C1       = <span class="number">22</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; I2C1. */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved23 = <span class="number">23</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved23 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved24 = <span class="number">24</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved24 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved25 = <span class="number">25</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved25 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved26 = <span class="number">26</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved26 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved27 = <span class="number">27</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved27 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved28 = <span class="number">28</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved28 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved29 = <span class="number">29</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved29 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved30 = <span class="number">30</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved30 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved31 = <span class="number">31</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved31 */</span></span><br><span class="line">    kDmaRequestMux0Group1FTM2Channel0 = <span class="number">32</span>|<span class="number">0x200</span>U, <span class="comment">/**&lt; FTM2 C0V. */</span></span><br><span class="line">    kDmaRequestMux0Group1FTM2Channel1 = <span class="number">33</span>|<span class="number">0x200</span>U, <span class="comment">/**&lt; FTM2 C1V. */</span></span><br><span class="line">    kDmaRequestMux0Group1SPI2Rx     = <span class="number">34</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; SPI2 Receive. */</span></span><br><span class="line">    kDmaRequestMux0Group1SPI2Tx     = <span class="number">35</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; SPI2 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0Group1IEEE1588Timer0 = <span class="number">36</span>|<span class="number">0x200</span>U, <span class="comment">/**&lt; ENET IEEE 1588 timer 0. */</span></span><br><span class="line">    kDmaRequestMux0Group1IEEE1588Timer1 = <span class="number">37</span>|<span class="number">0x200</span>U, <span class="comment">/**&lt; ENET IEEE 1588 timer 1. */</span></span><br><span class="line">    kDmaRequestMux0Group1IEEE1588Timer2 = <span class="number">38</span>|<span class="number">0x200</span>U, <span class="comment">/**&lt; ENET IEEE 1588 timer 2. */</span></span><br><span class="line">    kDmaRequestMux0Group1IEEE1588Timer3 = <span class="number">39</span>|<span class="number">0x200</span>U, <span class="comment">/**&lt; ENET IEEE 1588 timer 3. */</span></span><br><span class="line">    kDmaRequestMux0Group1HSADC1A    = <span class="number">40</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; HSADC1. */</span></span><br><span class="line">    kDmaRequestMux0Group1HSADC1B    = <span class="number">41</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; HSADC1. */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved42 = <span class="number">42</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved42 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved43 = <span class="number">43</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved43 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved44 = <span class="number">44</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved44 */</span></span><br><span class="line">    kDmaRequestMux0Group1ADC0       = <span class="number">45</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; ADC0. */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved46 = <span class="number">46</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved46 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved47 = <span class="number">47</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved47 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved48 = <span class="number">48</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved48 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved49 = <span class="number">49</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved49 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved50 = <span class="number">50</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved50 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved51 = <span class="number">51</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved51 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved52 = <span class="number">52</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved52 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved53 = <span class="number">53</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved53 */</span></span><br><span class="line">    kDmaRequestMux0Group1UART4Rx    = <span class="number">54</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; UART4 Receive. */</span></span><br><span class="line">    kDmaRequestMux0Group1UART4Tx    = <span class="number">55</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; UART4 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0Group1UART5Rx    = <span class="number">56</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; UART5 Receive. */</span></span><br><span class="line">    kDmaRequestMux0Group1UART5Tx    = <span class="number">57</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; UART5 Transmit. */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved58 = <span class="number">58</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved58 */</span></span><br><span class="line">    kDmaRequestMux0Group1Reserved59 = <span class="number">59</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; Reserved59 */</span></span><br><span class="line">    kDmaRequestMux0Group1AlwaysOn60 = <span class="number">60</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">    kDmaRequestMux0Group1AlwaysOn61 = <span class="number">61</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">    kDmaRequestMux0Group1AlwaysOn62 = <span class="number">62</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">    kDmaRequestMux0Group1AlwaysOn63 = <span class="number">63</span>|<span class="number">0x200</span>U,   <span class="comment">/**&lt; DMAMUX Always Enabled slot. */</span></span><br><span class="line">&#125; <span class="keyword">dma_request_source_t</span>;</span><br></pre></td></tr></table></figure><p>我们可以看到,触发源已经涵盖了大部分外设,需要注意的是60~63号触发源,这几个是常开触发源,主要可以用于需要一直触发快速搬运的地方或者是从内存搬运到内存的情况,官方解释如下((<a href="https://www.nxp.com/docs/en/reference-manual/KV5XP144M240RM.pdf" target="_blank" rel="noopener">摘自<strong>KV5x Sub-Family Reference Manual</strong> Page 480 </a>)):</p><blockquote><h2 id="25-5-3-Always-enabled-DMA-sources"><a href="#25-5-3-Always-enabled-DMA-sources" class="headerlink" title="25.5.3 Always-enabled DMA sources"></a>25.5.3 Always-enabled DMA sources</h2><p>In addition to the peripherals that can be used as DMA sources, there are four additional DMA sources that are always enabled. Unlike the peripheral DMA sources, where the peripheral controls the flow of data during DMA transfers, the sources that are always enabled provide no such “throttling” of the data transfers. These sources are most useful in the following cases:</p><ul><li>Performing DMA transfers to/from GPIO—Moving data from/to one or more GPIO pins, either unthrottled (that is, as fast as possible), or periodically (using the DMA triggering capability).</li><li>Performing DMA transfers from memory to memory—Moving data from memory to memory, typically as fast as possible, sometimes with software activation.</li><li>Performing DMA transfers from memory to the external bus, or vice-versa—Similar to memory to memory transfers, this is typically done as quickly as possible.</li><li>Any DMA transfer that requires software activation—Any DMA transfer that should be explicitly started by software.</li></ul></blockquote><h2 id="DMAMUX寄存器"><a href="#DMAMUX寄存器" class="headerlink" title="DMAMUX寄存器"></a>DMAMUX寄存器</h2><p>寄存器定义在MKV58F24.h中定义如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">   -- DMAMUX Peripheral Access Layer</span></span><br><span class="line"><span class="comment">   ---------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"> * @addtogroup DMAMUX_Peripheral_Access_Layer DMAMUX Peripheral Access Layer</span></span><br><span class="line"><span class="comment"> * @&#123;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** DMAMUX - Register Layout Typedef */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> CHCFG[<span class="number">32</span>];                          <span class="comment">/**&lt; Channel Configuration register, array offset: 0x0, array step: 0x1 */</span></span><br><span class="line">&#125; DMAMUX_Type;</span><br></pre></td></tr></table></figure><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%892%E5%9B%BE.png" alt=""></p><p>((<a href="https://www.nxp.com/docs/en/reference-manual/KV5XP144M240RM.pdf" target="_blank" rel="noopener">摘自<strong>KV5x Sub-Family Reference Manual</strong> Page 477 </a>))</p><p>可以看到非常的简单,每一个8位寄存器对应着每一个DMA通道.<br>ENBL用于开启相应的复用开关,SOURCE对应着前面枚举的64个DMA触发源.有点特殊的是TRIG,这个可以使用PIT定时器周期性触发DMA,不过只有前4个DMA通道支持该功能,关于详细的部分可以在PIT定时器的相关章节找到.</p><h2 id="DMAMUX配置顺序"><a href="#DMAMUX配置顺序" class="headerlink" title="DMAMUX配置顺序"></a>DMAMUX配置顺序</h2><ul><li>清空寄存器</li><li>选择相关的复用通道配置需要的触发源</li><li>选择是否需要周期触发功能</li><li>打开该复用通道</li></ul><p>以下是官方的解释((<a href="https://www.nxp.com/docs/en/reference-manual/KV5XP144M240RM.pdf" target="_blank" rel="noopener">摘自<strong>KV5x Sub-Family Reference Manual</strong> Page 481 </a>)):</p><blockquote><ul><li>Determine with which DMA channel the source will be associated. Note that only the first 4 DMA channels have periodic triggering capability.</li><li>Clear the CHCFG[ENBL] and CHCFG[TRIG] fields of the DMA channel.</li><li>Ensure that the DMA channel is properly configured in the DMA. The DMA channel may be enabled at this point.</li><li>Configure the corresponding timer.</li><li>Select the source to be routed to the DMA channel. Write to the corresponding CHCFG register, ensuring that the CHCFG[ENBL] and CHCFG[TRIG] fields are set.</li></ul></blockquote><h2 id="DMAMUX配置实例"><a href="#DMAMUX配置实例" class="headerlink" title="DMAMUX配置实例"></a>DMAMUX配置实例</h2><p>以下是一个DMAMUX配置的例子</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SIM-&gt;SCGC6 |= SIM_SCGC6_DMAMUX_MASK; <span class="comment">//打开DMAMUX时钟</span></span><br><span class="line">DMAMUX-&gt;CHCFG[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">//清空寄存器通道0</span></span><br><span class="line">DMAMUX-&gt;CHCFG[<span class="number">0</span>] |= DMAMUX_CHCFG_SOURCE(kDmaRequestMux0AlwaysOn63);<span class="comment">//配置63号源到通道0</span></span><br><span class="line">DMAMUX-&gt;CHCFG[<span class="number">0</span>] |= DMAMUX_CHCFG_ENBL_MASK;<span class="comment">//使能通道</span></span><br></pre></td></tr></table></figure><h1 id="eDMA模块"><a href="#eDMA模块" class="headerlink" title="eDMA模块"></a>eDMA模块</h1><p>接下来才是重头戏,eDMA模块.</p><h2 id="eDMA-特性"><a href="#eDMA-特性" class="headerlink" title="eDMA 特性"></a>eDMA 特性</h2><p>下面介绍下Kinetis的eDMA的一些特性，有点多，就挑重点和特色的来说了：</p><ul><li>16个独立可配置的DMA通道，其中前四个通道可配置成周期性触发(需要用到PIT模块).</li><li>52个外设触发slots(这个我担心翻译不好误人子弟了就直接用该单词替代了,用过Qt的人都这是个槽的概念,大家权当触发源来理解吧),10个直通slots,每一个slot可以通过软件编程路由到16个DMA通道中的任意一个(这个通过配置DMAMUX_CONFIGn得到).</li><li>独立可编程的源地址、目标地址和传输宽度(8bit,16bit,32bit,另外支持16byte的缓存),支持外设到RAM,RAM到外设,RAM到RAM之间的传输.<br>*　每一个通道都有一个11个寄存器的TCD（Tranfer control descripter），注意这11个寄存器（包括16位和32位宽度的寄存器）才是我们编写驱动的重点对象．</li><li>固定的优先级模式和时间轮询（round-robin）优先级模式（注意：如果不通过软件设置优先级的话，系统默认为每个通道的优先级等于它的通道号，即0通道的优先级为0，且优先级号越小，其优先级越低）</li><li>每个通道包括了三个中断标志，即DMA半传输完成标志、DMA传输完成标志和DMA传输出错标志，3个标志逻辑或成一个中断请求（所以如果都使能了，那可以通过查询相关标志寄存器来判断当前的中断类型）.</li><li>可软件中断取消DMA传输（通过配置DMA_CR_CX位）.</li></ul><p>以下是官方的解释((<a href="https://www.nxp.com/docs/en/reference-manual/KV5XP144M240RM.pdf" target="_blank" rel="noopener">摘自<strong>KV5x Sub-Family Reference Manual</strong> Page 487 </a>)):</p><blockquote><h2 id="26-1-3-Features"><a href="#26-1-3-Features" class="headerlink" title="26.1.3 Features"></a>26.1.3 Features</h2><p>The eDMA is a highly programmable data-transfer engine optimized to minimize any required intervention from the host processor. It is intended for use in applications where the data size to be transferred is statically known and not defined within the transferred data itself. The eDMA module features:</p><ul><li>All data movement via dual-address transfers: read from source, write to destination</li><li>Programmable source and destination addresses and transfer size<br>*Support for enhanced addressing modes</li><li>32-channel implementation that performs complex data transfers with minimal intervention from a host processor<br>*　Internal data buffer, used as temporary storage to support 16- and 32-byte transfers</li><li>Connections to the crossbar switch for bus mastering the data movement</li><li>Transfer control descriptor (TCD) organized to support two-deep, nested transfer operations</li><li>32-byte TCD stored in local memory for each channel</li><li>An inner data transfer loop defined by a minor byte transfer count<br>*An outer data transfer loop defined by a major iteration count</li><li>Channel activation via one of three methods:</li><li>Explicit software initiation</li><li>Initiation via a channel-to-channel linking mechanism for continuous transfers</li><li>Peripheral-paced hardware requests, one per channel</li><li>Fixed-priority and round-robin channel arbitration</li><li>Channel completion reported via programmable interrupt requests</li><li>One interrupt per channel, which can be asserted at completion of major iteration count</li><li>Programmable error terminations per channel and logically summed together to form one error interrupt to the interrupt controller</li><li>Programmable support for scatter/gather DMA processing</li><li>Support for complex data structures</li></ul></blockquote><blockquote><p>In the discussion of this module, n is used to reference the channel number.</p></blockquote><h2 id="eDMA-channel分组"><a href="#eDMA-channel分组" class="headerlink" title="eDMA channel分组:"></a>eDMA channel分组:</h2><p>KV58中DMA通道分为两组</p><ul><li>group0 0~15通道</li><li>group1 16~31通道<br>不同通道需要设置成不同的权值,这是非常容易忽略的地方.</li></ul><h2 id="主循环和附循环"><a href="#主循环和附循环" class="headerlink" title="主循环和附循环"></a>主循环和附循环</h2><p>数据的传送分为主循环 （ major loop ） 和副循环 （ minor loop ）. 如何理解这两个概念呢。 我们不妨假设用软件来实现有规律的顺序数据传送，使用 C 语言来实现的话，可以用 for 循 环。好比用两层嵌套的 for 循环来实现。如使用 DMA 做同样的工作，过程是相同的，外层 的循环又称主循环，即 major loop 。内层循环称为副循环，即 minor loop 。 major loop 循环 一次，可能需要 minor loop 循环多次。每个 minor loop 循环都需要 DMA 源发来请求或者通 过软件请求。 每个 minor loop 传送完毕， 对应的 DMA 通道就进入空闲模式， 等待下一次 DMA 请求。当所有 DMA 传送完毕，即置 DONE 标志，并且可以通过设置选择传送完毕是否触发 中断。</p><h2 id="eDMA寄存器介绍"><a href="#eDMA寄存器介绍" class="headerlink" title="eDMA寄存器介绍"></a>eDMA寄存器介绍</h2><p>以下是eDMA模块寄存器表(摘自MKV58F24.h):<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* ----------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">   -- DMA Peripheral Access Layer</span></span><br><span class="line"><span class="comment">   ---------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"> * @addtogroup DMA_Peripheral_Access_Layer DMA Peripheral Access Layer</span></span><br><span class="line"><span class="comment"> * @&#123;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** DMA - Register Layout Typedef */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  __IO <span class="keyword">uint32_t</span> CR;                                <span class="comment">/**&lt; Control Register, offset: 0x0 */</span></span><br><span class="line">  __I  <span class="keyword">uint32_t</span> ES;                                <span class="comment">/**&lt; Error Status Register, offset: 0x4 */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_0[<span class="number">4</span>];</span><br><span class="line">  __IO <span class="keyword">uint32_t</span> ERQ;                               <span class="comment">/**&lt; Enable Request Register, offset: 0xC */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_1[<span class="number">4</span>];</span><br><span class="line">  __IO <span class="keyword">uint32_t</span> EEI;                               <span class="comment">/**&lt; Enable Error Interrupt Register, offset: 0x14 */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> CEEI;                               <span class="comment">/**&lt; Clear Enable Error Interrupt Register, offset: 0x18 */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> SEEI;                               <span class="comment">/**&lt; Set Enable Error Interrupt Register, offset: 0x19 */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> CERQ;                               <span class="comment">/**&lt; Clear Enable Request Register, offset: 0x1A */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> SERQ;                               <span class="comment">/**&lt; Set Enable Request Register, offset: 0x1B */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> CDNE;                               <span class="comment">/**&lt; Clear DONE Status Bit Register, offset: 0x1C */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> SSRT;                               <span class="comment">/**&lt; Set START Bit Register, offset: 0x1D */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> CERR;                               <span class="comment">/**&lt; Clear Error Register, offset: 0x1E */</span></span><br><span class="line">  __O  <span class="keyword">uint8_t</span> CINT;                               <span class="comment">/**&lt; Clear Interrupt Request Register, offset: 0x1F */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_2[<span class="number">4</span>];</span><br><span class="line">  __IO <span class="keyword">uint32_t</span> INT;                               <span class="comment">/**&lt; Interrupt Request Register, offset: 0x24 */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_3[<span class="number">4</span>];</span><br><span class="line">  __IO <span class="keyword">uint32_t</span> ERR;                               <span class="comment">/**&lt; Error Register, offset: 0x2C */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_4[<span class="number">4</span>];</span><br><span class="line">  __I  <span class="keyword">uint32_t</span> HRS;                               <span class="comment">/**&lt; Hardware Request Status Register, offset: 0x34 */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_5[<span class="number">12</span>];</span><br><span class="line">  __IO <span class="keyword">uint32_t</span> EARS;                              <span class="comment">/**&lt; Enable Asynchronous Request in Stop Register, offset: 0x44 */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_6[<span class="number">184</span>];</span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI3;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x100 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI2;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x101 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI1;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x102 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI0;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x103 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI7;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x104 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI6;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x105 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI5;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x106 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI4;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x107 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI11;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x108 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI10;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x109 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI9;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x10A */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI8;                            <span class="comment">/**&lt; Channel n Priority Register, offset: 0x10B */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI15;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x10C */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI14;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x10D */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI13;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x10E */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI12;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x10F */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI19;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x110 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI18;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x111 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI17;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x112 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI16;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x113 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI23;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x114 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI22;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x115 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI21;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x116 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI20;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x117 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI27;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x118 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI26;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x119 */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI25;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x11A */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI24;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x11B */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI31;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x11C */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI30;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x11D */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI29;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x11E */</span></span><br><span class="line">  __IO <span class="keyword">uint8_t</span> DCHPRI28;                           <span class="comment">/**&lt; Channel n Priority Register, offset: 0x11F */</span></span><br><span class="line">       <span class="keyword">uint8_t</span> RESERVED_7[<span class="number">3808</span>];</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> &#123;</span>                                         <span class="comment">/* offset: 0x1000, array step: 0x20 */</span></span><br><span class="line">    __IO <span class="keyword">uint32_t</span> SADDR;                             <span class="comment">/**&lt; TCD Source Address, array offset: 0x1000, array step: 0x20 */</span></span><br><span class="line">    __IO <span class="keyword">uint16_t</span> SOFF;                              <span class="comment">/**&lt; TCD Signed Source Address Offset, array offset: 0x1004, array step: 0x20 */</span></span><br><span class="line">    __IO <span class="keyword">uint16_t</span> ATTR;                              <span class="comment">/**&lt; TCD Transfer Attributes, array offset: 0x1006, array step: 0x20 */</span></span><br><span class="line">    <span class="keyword">union</span> &#123;                                          <span class="comment">/* offset: 0x1008, array step: 0x20 */</span></span><br><span class="line">      __IO <span class="keyword">uint32_t</span> NBYTES_MLNO;                       <span class="comment">/**&lt; TCD Minor Byte Count (Minor Loop Mapping Disabled), array offset: 0x1008, array step: 0x20 */</span></span><br><span class="line">      __IO <span class="keyword">uint32_t</span> NBYTES_MLOFFNO;                    <span class="comment">/**&lt; TCD Signed Minor Loop Offset (Minor Loop Mapping Enabled and Offset Disabled), array offset: 0x1008, array step: 0x20 */</span></span><br><span class="line">      __IO <span class="keyword">uint32_t</span> NBYTES_MLOFFYES;                   <span class="comment">/**&lt; TCD Signed Minor Loop Offset (Minor Loop Mapping and Offset Enabled), array offset: 0x1008, array step: 0x20 */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    __IO <span class="keyword">uint32_t</span> SLAST;                             <span class="comment">/**&lt; TCD Last Source Address Adjustment, array offset: 0x100C, array step: 0x20 */</span></span><br><span class="line">    __IO <span class="keyword">uint32_t</span> DADDR;                             <span class="comment">/**&lt; TCD Destination Address, array offset: 0x1010, array step: 0x20 */</span></span><br><span class="line">    __IO <span class="keyword">uint16_t</span> DOFF;                              <span class="comment">/**&lt; TCD Signed Destination Address Offset, array offset: 0x1014, array step: 0x20 */</span></span><br><span class="line">    <span class="keyword">union</span> &#123;                                          <span class="comment">/* offset: 0x1016, array step: 0x20 */</span></span><br><span class="line">      __IO <span class="keyword">uint16_t</span> CITER_ELINKNO;                     <span class="comment">/**&lt; TCD Current Minor Loop Link, Major Loop Count (Channel Linking Disabled), array offset: 0x1016, array step: 0x20 */</span></span><br><span class="line">      __IO <span class="keyword">uint16_t</span> CITER_ELINKYES;                    <span class="comment">/**&lt; TCD Current Minor Loop Link, Major Loop Count (Channel Linking Enabled), array offset: 0x1016, array step: 0x20 */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    __IO <span class="keyword">uint32_t</span> DLAST_SGA;                         <span class="comment">/**&lt; TCD Last Destination Address Adjustment/Scatter Gather Address, array offset: 0x1018, array step: 0x20 */</span></span><br><span class="line">    __IO <span class="keyword">uint16_t</span> CSR;                               <span class="comment">/**&lt; TCD Control and Status, array offset: 0x101C, array step: 0x20 */</span></span><br><span class="line">    <span class="keyword">union</span> &#123;                                          <span class="comment">/* offset: 0x101E, array step: 0x20 */</span></span><br><span class="line">      __IO <span class="keyword">uint16_t</span> BITER_ELINKNO;                     <span class="comment">/**&lt; TCD Beginning Minor Loop Link, Major Loop Count (Channel Linking Disabled), array offset: 0x101E, array step: 0x20 */</span></span><br><span class="line">      __IO <span class="keyword">uint16_t</span> BITER_ELINKYES;                    <span class="comment">/**&lt; TCD Beginning Minor Loop Link, Major Loop Count (Channel Linking Enabled), array offset: 0x101E, array step: 0x20 */</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; TCD[<span class="number">32</span>];</span><br><span class="line">&#125; DMA_Type;</span><br></pre></td></tr></table></figure><p></p><h3 id="首先介绍非常重要的TCD传输控制块寄存器"><a href="#首先介绍非常重要的TCD传输控制块寄存器" class="headerlink" title="首先介绍非常重要的TCD传输控制块寄存器"></a>首先介绍非常重要的TCD传输控制块寄存器</h3><p>以下是TCD控制块的寄存器分布((<a href="https://www.nxp.com/docs/en/reference-manual/KV5XP144M240RM.pdf" target="_blank" rel="noopener">摘自<strong>KV5x Sub-Family Reference Manual</strong> Page 489 </a>)):</p><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89%E5%9B%BE2.png" alt=""></p><h4 id="TCD-Source-Address-DMA-TCDn-SADDR"><a href="#TCD-Source-Address-DMA-TCDn-SADDR" class="headerlink" title="TCD Source Address (DMA_TCDn_SADDR)"></a>TCD Source Address (DMA_TCDn_SADDR)</h4><p>存放需要搬运的数据的源地址</p><h4 id="TCD-Signed-Source-Address-Offset-DMA-TCDn-SOFF"><a href="#TCD-Signed-Source-Address-Offset-DMA-TCDn-SOFF" class="headerlink" title="TCD Signed Source Address Offset (DMA_TCDn_SOFF)"></a>TCD Signed Source Address Offset (DMA_TCDn_SOFF)</h4><p>源地址传输一个数据之后的偏移量<br>(Sign-extended offset applied to the current source address to form the next-state value as each source read is completed.)</p><h4 id="TCD-Transfer-Attributes-DMA-TCDn-ATTR"><a href="#TCD-Transfer-Attributes-DMA-TCDn-ATTR" class="headerlink" title="TCD Transfer Attributes (DMA_TCDn_ATTR)"></a>TCD Transfer Attributes (DMA_TCDn_ATTR)</h4><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%8922%E5%9B%BE.png" alt=""></p><p>主要说其中的SSIZE和DSIZE,分别表示每一次传输的源数据宽度和目的数据宽度<br>其中000表示8bit, 001表示16bit, 010表示32bit.</p><h4 id="TCD-Minor-Byte-Count-Minor-Loop-Mapping-Disabled-DMA-TCDn-NBYTES-MLNO"><a href="#TCD-Minor-Byte-Count-Minor-Loop-Mapping-Disabled-DMA-TCDn-NBYTES-MLNO" class="headerlink" title="TCD Minor Byte Count (Minor Loop Mapping Disabled) (DMA_TCDn_NBYTES_MLNO)"></a>TCD Minor Byte Count (Minor Loop Mapping Disabled) (DMA_TCDn_NBYTES_MLNO)</h4><p>仅介绍这一种情况,即附循环映射被禁止的情况,寄存器的值表示一次附循环搬移的数据大小,如果为0则表示搬运4GB.</p><h4 id="TCD-Last-Source-Address-Adjustment-DMA-TCDn-SLAST"><a href="#TCD-Last-Source-Address-Adjustment-DMA-TCDn-SLAST" class="headerlink" title="TCD Last Source Address Adjustment (DMA_TCDn_SLAST)"></a>TCD Last Source Address Adjustment (DMA_TCDn_SLAST)</h4><p>该寄存器控制当主循环结束后源地址的偏移情况,寄存器值可为正或负,0表示不偏移.</p><h4 id="TCD-Destination-Address-DMA-TCDn-DADDR"><a href="#TCD-Destination-Address-DMA-TCDn-DADDR" class="headerlink" title="TCD Destination Address (DMA_TCDn_DADDR)"></a>TCD Destination Address (DMA_TCDn_DADDR)</h4><p>储存目标地址</p><h4 id="TCD-Signed-Destination-Address-Offset-DMA-TCDn-DOFF"><a href="#TCD-Signed-Destination-Address-Offset-DMA-TCDn-DOFF" class="headerlink" title="TCD Signed Destination Address Offset (DMA_TCDn_DOFF)"></a>TCD Signed Destination Address Offset (DMA_TCDn_DOFF)</h4><p>目标地址传输一个数据之后的偏移量</p><h4 id="TCD-Current-Minor-Loop-Link-Major-Loop-Count-Channel-Linking-Disabled-DMA-TCDn-CITER-ELINKNO"><a href="#TCD-Current-Minor-Loop-Link-Major-Loop-Count-Channel-Linking-Disabled-DMA-TCDn-CITER-ELINKNO" class="headerlink" title="TCD Current Minor Loop Link, Major Loop Count (Channel Linking Disabled) (DMA_TCDn_CITER_ELINKNO)"></a>TCD Current Minor Loop Link, Major Loop Count (Channel Linking Disabled) (DMA_TCDn_CITER_ELINKNO)</h4><p>仅介绍这一种情况,也就是通道之间的联系被禁止的情况.该寄存器用于表示主循环的次数.</p><h4 id="TCD-Beginning-Minor-Loop-Link-Major-Loop-Count-Channel-Linking-Disabled-DMA-TCDn-BITER-ELINKNO"><a href="#TCD-Beginning-Minor-Loop-Link-Major-Loop-Count-Channel-Linking-Disabled-DMA-TCDn-BITER-ELINKNO" class="headerlink" title="TCD Beginning Minor Loop Link, Major Loop Count (Channel Linking Disabled) (DMA_TCDn_BITER_ELINKNO)"></a>TCD Beginning Minor Loop Link, Major Loop Count (Channel Linking Disabled) (DMA_TCDn_BITER_ELINKNO)</h4><p>仅介绍这一种情况,该寄存器应与<code>CITER</code>寄存器配置成相同的值</p><h4 id="TCD-Last-Destination-Address-Adjustment-Scatter-Gather-Address-DMA-TCDn-DLASTSGA"><a href="#TCD-Last-Destination-Address-Adjustment-Scatter-Gather-Address-DMA-TCDn-DLASTSGA" class="headerlink" title="TCD Last Destination Address Adjustment/Scatter Gather Address (DMA_TCDn_DLASTSGA)"></a>TCD Last Destination Address Adjustment/Scatter Gather Address (DMA_TCDn_DLASTSGA)</h4><p>该寄存器控制当主循环结束后目标地址的偏移情况,寄存器值可为正或负,0表示不偏移.</p><h4 id="TCD-Control-and-Status-DMA-TCDn-CSR"><a href="#TCD-Control-and-Status-DMA-TCDn-CSR" class="headerlink" title="TCD Control and Status (DMA_TCDn_CSR)"></a>TCD Control and Status (DMA_TCDn_CSR)</h4><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89%E5%9B%BE4.png" alt=""></p><p>INTMAJOR: 允许中断<br>START:软件触发传输</p><h2 id="eDMA引擎寄存器"><a href="#eDMA引擎寄存器" class="headerlink" title="eDMA引擎寄存器"></a>eDMA引擎寄存器</h2><h4 id="Control-Register-DMA-CR"><a href="#Control-Register-DMA-CR" class="headerlink" title="Control Register (DMA_CR)"></a>Control Register (DMA_CR)</h4><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89111%E5%9B%BE.png" alt=""></p><p>最需要注意的就是<code>GRP1PRI</code>和<code>GRP0PRI</code>需要设置成不同的权值</p><h4 id="Error-Status-Register-DMA-ES"><a href="#Error-Status-Register-DMA-ES" class="headerlink" title="Error Status Register (DMA_ES)"></a>Error Status Register (DMA_ES)</h4><p>各种错误标志位寄存器</p><h4 id="Enable-Request-Register-DMA-ERQ"><a href="#Enable-Request-Register-DMA-ERQ" class="headerlink" title="Enable Request Register (DMA_ERQ)"></a>Enable Request Register (DMA_ERQ)</h4><p>允许传输寄存器</p><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%891234%E5%9B%BE.png" alt=""></p><h4 id="Channel-n-Priority-Register-DMA-DCHPRIn"><a href="#Channel-n-Priority-Register-DMA-DCHPRIn" class="headerlink" title="Channel n Priority Register (DMA_DCHPRIn)"></a>Channel n Priority Register (DMA_DCHPRIn)</h4><p>优先级分组寄存器,0是最低优先级.</p><h1 id="DMA模块初始化过程"><a href="#DMA模块初始化过程" class="headerlink" title="DMA模块初始化过程"></a>DMA模块初始化过程</h1><ul><li>配置CR寄存器</li><li>配置通道优先级</li><li>配置TCD传输控制块</li><li>使能传输控制</li><li>配置外设允许DMA触发或者配置软件触发</li></ul><p>以下是官方解释((<a href="https://www.nxp.com/docs/en/reference-manual/KV5XP144M240RM.pdf" target="_blank" rel="noopener">摘自<strong>KV5x Sub-Family Reference Manual</strong> Page 575 </a>)):</p><blockquote><h3 id="To-initialize-the-eDMA"><a href="#To-initialize-the-eDMA" class="headerlink" title="To initialize the eDMA:"></a>To initialize the eDMA:</h3><ul><li>Write to the CR if a configuration other than the default is desired.</li><li>Write the channel priority levels to the DCHPRIn registers if a configuration other than the default is desired.</li><li>Enable error interrupts in the EEI register if so desired.</li><li>Write the 32-byte TCD for each channel that may request service.</li><li>Enable any hardware service requests via the ERQ register.</li><li>Request channel service via.</li></ul></blockquote><h1 id="DMA从内存到内存传输实例"><a href="#DMA从内存到内存传输实例" class="headerlink" title="DMA从内存到内存传输实例"></a>DMA从内存到内存传输实例</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* Init board hardware. */</span></span><br><span class="line">  BOARD_InitBootPins();</span><br><span class="line">  BOARD_InitBootClocks();</span><br><span class="line">  BOARD_InitDebugConsole();</span><br><span class="line"></span><br><span class="line">  SIM-&gt;SCGC7 |= SIM_SCGC7_DMA_MASK;   <span class="comment">//打开DMA时钟</span></span><br><span class="line">  SIM-&gt;SCGC6 |= SIM_SCGC6_DMAMUX_MASK;<span class="comment">//打开DMAMUX时钟</span></span><br><span class="line"></span><br><span class="line">  DMAMUX-&gt;CHCFG[<span class="number">0</span>] = <span class="number">0</span>;<span class="comment">//清寄存器</span></span><br><span class="line">  DMAMUX-&gt;CHCFG[<span class="number">0</span>] |= DMAMUX_CHCFG_SOURCE(kDmaRequestMux0AlwaysOn63);<span class="comment">//配置通道0的源为63号源</span></span><br><span class="line">  DMAMUX-&gt;CHCFG[<span class="number">0</span>] |= DMAMUX_CHCFG_ENBL_MASK;/使能通道</span><br><span class="line">  </span><br><span class="line">  DMA0-&gt;CR=<span class="number">0</span>;<span class="comment">//清寄存器</span></span><br><span class="line">  DMA0-&gt;CR |= DMA_CR_GRP0PRI_MASK;<span class="comment">//设置group0的优先级为1</span></span><br><span class="line">  DMA0-&gt;EEI |= DMA_EEI_EEI0_MASK;<span class="comment">//允许错误中断</span></span><br><span class="line">  DMA0-&gt;INT |= DMA_INT_INT0_MASK;<span class="comment">//清中断标志位</span></span><br><span class="line">  </span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].SADDR=(<span class="keyword">uint32_t</span>)sendtext; <span class="comment">//设置源地址</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].SOFF=<span class="number">1</span>; <span class="comment">//偏移量设置成1,每传输一个字节偏移一个字节</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].ATTR =<span class="number">0</span>; <span class="comment">//每次传输8bit</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].NBYTES_MLNO=<span class="number">1</span>; <span class="comment">//附循环一次</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].SLAST=<span class="number">0</span>; <span class="comment">//传输结束后地址不偏移</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].DADDR=(<span class="keyword">uint32_t</span>)receivetext;<span class="comment">//设置目标地址</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].DOFF=<span class="number">1</span>; /偏移量设置成<span class="number">1</span>,每传输一个字节偏移一个字节</span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].CITER_ELINKNO = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">sizeof</span>(sendtext)<span class="number">-1</span>); <span class="comment">//主循环次数</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].DLAST_SGA=<span class="number">0</span>; <span class="comment">//传输结束后不处理</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].CSR |= (DMA_CSR_INTMAJOR_MASK); <span class="comment">//主循环后触发中断</span></span><br><span class="line">  DMA0-&gt;TCD[<span class="number">0</span>].BITER_ELINKNO = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">sizeof</span>(sendtext)<span class="number">-1</span>); <span class="comment">//与CITER值相同</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  NVIC_EnableIRQ(DMA0_DMA16_IRQn); <span class="comment">//允许中断</span></span><br><span class="line">  DMA0-&gt;ERQ |= DMA_EARS_EDREQ_0_MASK; <span class="comment">//允许DMA传输</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际效果:</p><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89456%E5%9B%BE.png" alt=""></p><p>传输前receivetext为空</p><p><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%8912344%E5%9B%BE.png" alt=""></p><p>传输后receivetext值和sendtext相同</p><div class="post-announce">感谢您的阅读，本文由 <a href="http://blog.zzshub.cn">ZZS</a> 版权所有。如若转载，请注明出处：ZZS（<a href="http://blog.zzshub.cn/2018/01/30/DMAregister/">http://blog.zzshub.cn/2018/01/30/DMAregister/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/01/22/KinetisRegistar/" title="ARM寄存器食用感受"><i class="iconfont icon-prev"></i>ARM寄存器食用感受</a></div><div class="post__prev post__prev--right"><a href="/2018/02/04/HSADC/" title="kinetis KV58 HSADC模块食用指南">kinetis KV58 HSADC模块食用指南<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流的个人博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/系统测试/">系统测试</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/作品/">作品</a><span class="block-list-count">1</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2018/02/07/FTM/" title="kinetis KV58 FTM模块食用指南"><div class="item__cover"><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89999%E5%9B%BE.png" alt="kinetis KV58 FTM模块食用指南"></div><div class="item__info"><h3 class="item__title">kinetis KV58 FTM模块食用指南</h3><span class="item__text">2018-02-07</span></div></a></li><li class="latest-post-item"><a href="/2018/02/05/kinetisadc/" title="kinetis KV58 ADC模块食用指南"><div class="item__cover"><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89999%E5%9B%BE.png" alt="kinetis KV58 ADC模块食用指南"></div><div class="item__info"><h3 class="item__title">kinetis KV58 ADC模块食用指南</h3><span class="item__text">2018-02-05</span></div></a></li><li class="latest-post-item"><a href="/2018/02/04/HSADC/" title="kinetis KV58 HSADC模块食用指南"><div class="item__cover"><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89999%E5%9B%BE.png" alt="kinetis KV58 HSADC模块食用指南"></div><div class="item__info"><h3 class="item__title">kinetis KV58 HSADC模块食用指南</h3><span class="item__text">2018-02-04</span></div></a></li><li class="latest-post-item"><a href="/2018/01/30/DMAregister/" title="kinetis KV58 DMA模块食用指南"><div class="item__cover"><img src="http://zzshubimage-1253829354.file.myqcloud.com/%E5%AF%84%E5%AD%98%E5%99%A8%E9%A3%9F%E7%94%A8/DMA/%E8%8D%89999%E5%9B%BE.png" alt="kinetis KV58 DMA模块食用指南"></div><div class="item__info"><h3 class="item__title">kinetis KV58 DMA模块食用指南</h3><span class="item__text">2018-01-30</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/2017电赛/">2017电赛</a></li><li class="tag-item"><a class="tag-link" href="/tags/718创新实验室/">718创新实验室</a></li><li class="tag-item"><a class="tag-link" href="/tags/ARM/">ARM</a></li><li class="tag-item"><a class="tag-link" href="/tags/Linux/">Linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/OpenWrt/">OpenWrt</a></li><li class="tag-item"><a class="tag-link" href="/tags/Qt/">Qt</a></li><li class="tag-item"><a class="tag-link" href="/tags/STM32/">STM32</a></li><li class="tag-item"><a class="tag-link" href="/tags/blog/">blog</a></li><li class="tag-item"><a class="tag-link" href="/tags/github/">github</a></li><li class="tag-item"><a class="tag-link" href="/tags/hexo/">hexo</a></li><li class="tag-item"><a class="tag-link" href="/tags/kinetis/">kinetis</a></li><li class="tag-item"><a class="tag-link" href="/tags/mips/">mips</a></li><li class="tag-item"><a class="tag-link" href="/tags/register/">register</a></li><li class="tag-item"><a class="tag-link" href="/tags/个人总结/">个人总结</a></li><li class="tag-item"><a class="tag-link" href="/tags/作品/">作品</a></li><li class="tag-item"><a class="tag-link" href="/tags/安卓/">安卓</a></li><li class="tag-item"><a class="tag-link" href="/tags/蓝牙/">蓝牙</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>威海,山东省,中国</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>m18996002212@me.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="http://zzshubimage-1253829354.cosbj.myqcloud.com/blog/zzslogo.jpg" alt="logo" title="ZZS"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="http://www.hitwh.edu.cn" title="school_name" target="_blank">哈尔滨工业大学</a></li><li class="list-item"><a href="http://blog.minfive.com/" title="Blog" target="_blank">MINFIVE</a></li><li class="list-item"><a href="http://lzw429.site" title="Blog" target="_blank">待兔者</a></li><li class="list-item"><a href="http://xblame.top/" title="Blog" target="_blank">Blameying</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog_Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/ZzzzzzS" target="_blank">ZZS</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/ZzzzzzS" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:m18996002212@me.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="https://www.zhihu.com/people/zhou-zi-shun-45/activities" target="_blank" title="知乎"><i class="iconfont icon-zhihu"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["ARM","kinetis","register"],gitalk=new Gitalk({clientID:"9694bc2db55eb2d27215",clientSecret:"a69ae19d3dc81b47c3aca670b6a16f64bfd9cd3f",repo:"ZzzzzzS.github.io",owner:"ZzzzzzS",admin:["ZzzzzzS"],labels:tags,id:new Date(1517292752e3).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>