<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>强化学习仿真器Raisim的安装，配置，与初步使用 | ZZSHUB</title><meta name="author" content="Zishun Zhou"><meta name="copyright" content="Zishun Zhou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="强化学习仿真器Raisim的安装，配置，与初步使用 写在前面 – 最近入坑了强化学习，看了一些基础理论后觉得需要实操一下，于是便研究了一下Raisim这个仿真器。这个仿真器使用的人较少，网上资料也不多，所以在这里记录一下，以便后续查阅。不过说实话，新入强化学习的坑还是建议从OpenAI的gym(gymnasium)看起，毕竟资料多，而且也有很多成熟的算法可以直接使用。不像Raisim是一个单纯的仿">
<meta property="og:type" content="article">
<meta property="og:title" content="强化学习仿真器Raisim的安装，配置，与初步使用">
<meta property="og:url" content="https://blog.zzshub.cn/2023/07/26/DRL_RaisimInstall/index.html">
<meta property="og:site_name" content="ZZSHUB">
<meta property="og:description" content="强化学习仿真器Raisim的安装，配置，与初步使用 写在前面 – 最近入坑了强化学习，看了一些基础理论后觉得需要实操一下，于是便研究了一下Raisim这个仿真器。这个仿真器使用的人较少，网上资料也不多，所以在这里记录一下，以便后续查阅。不过说实话，新入强化学习的坑还是建议从OpenAI的gym(gymnasium)看起，毕竟资料多，而且也有很多成熟的算法可以直接使用。不像Raisim是一个单纯的仿">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/logo.png">
<meta property="article:published_time" content="2023-07-26T06:12:32.000Z">
<meta property="article:modified_time" content="2024-07-02T05:07:11.679Z">
<meta property="article:author" content="Zishun Zhou">
<meta property="article:tag" content="强化学习">
<meta property="article:tag" content="仿真器">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/logo.png"><link rel="shortcut icon" href="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/logo.ico"><link rel="canonical" href="https://blog.zzshub.cn/2023/07/26/DRL_RaisimInstall/index.html"><link rel="preconnect" href="//cdnjs.cloudflare.com"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="blth2QTunwBDdAVeivflGOQ5yFAKkRto5hERrzSe7Zw"/><meta name="baidu-site-verification" content="J5gSYw6HO1"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?30631f1de6b7510bb2f006c33e30d765";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "n0xcwltp2w");</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdnjs.cloudflare.com/ajax/libs/egjs-infinitegrid/4.11.1/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '强化学习仿真器Raisim的安装，配置，与初步使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-02 13:07:11'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="ZZSHUB" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/zzslogo.jpg" onerror="onerror=null;src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时光机</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/logo.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ZZSHUB"><span class="site-name">ZZSHUB</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时光机</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">强化学习仿真器Raisim的安装，配置，与初步使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-26T06:12:32.000Z" title="发表于 2023-07-26 14:12:32">2023-07-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-02T05:07:11.679Z" title="更新于 2024-07-02 13:07:11">2024-07-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="强化学习仿真器Raisim的安装，配置，与初步使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="强化学习仿真器Raisim的安装，配置，与初步使用"><a href="#强化学习仿真器Raisim的安装，配置，与初步使用" class="headerlink" title="强化学习仿真器Raisim的安装，配置，与初步使用"></a>强化学习仿真器Raisim的安装，配置，与初步使用</h1><blockquote>
<p><strong>写在前面</strong> – 最近入坑了强化学习，看了一些基础理论后觉得需要实操一下，于是便研究了一下Raisim这个仿真器。这个仿真器使用的人较少，网上资料也不多，所以在这里记录一下，以便后续查阅。不过说实话，新入强化学习的坑还是建议从OpenAI的gym(gymnasium)看起，毕竟资料多，而且也有很多成熟的算法可以直接使用。不像Raisim是一个单纯的仿真器，gym是一个完整的强化学习框架，可以直接使用，以及配合”stable baseline3”使用可以很快速的将demo跑起来。不过Raisim的优点也很明显，就是仿真速度快，而且可以直接使用C++进行编程，并利用OpenMP并行加速。所以在一些对速度要求较高的场景下，Raisim还是很有优势的。</p>
</blockquote>
<p>本文主要介绍了Raisim仿真器的安装，配置，并简要介绍API，以及如何使用Raisim仿真器来进行强化学习仿真环境的搭建。本文主要参考了Raisim官方文档，以及Raisim的github仓库中的一些例子。部分内容使用AI辅助生成。</p>
<h1 id="Raisim简介和安装"><a href="#Raisim简介和安装" class="headerlink" title="Raisim简介和安装"></a>Raisim简介和安装</h1><p>Raisim是由ETH Zurich的Robotics and Perception Group开发的一个开源的跨平台物理仿真器，主要用于机器人的仿真。该仿真器的主要特点是仿真速度快，而且可以直接使用C++进行编程，并利用OpenMP并行加速。该仿真器使用CPU进行仿真，官方地址为：<a target="_blank" rel="noopener" href="https://raisim.com/">https://raisim.com/</a>。</p>
<p>该仿真器的安装较为简单，基本上只需要下载源码，然后编译即可。该仿真器在分发的时候直接分发的二进制文件，因此编译的过程基本就是在编译demo，以及一些测试用例。安装过程遵循官方文档即可，所需依赖包括eigen和cmake，Windows平台使用vs2022编译实测通过，但由于gym对Windows的支持不太好，因此建议使用Linux平台进行开发，这里最终选择了WSL2下的Ubuntu22.04开发。在官方的安装教程中提到了需要设置<code>&quot;WORKSPACE&quot;</code>和<code>&quot;LOCAL_INSTALL&quot;</code>环境变量，但是实际测试发现这些环境变量不需要设置，直接安装即可。Linux平台执行<code>make install</code>命令后会将raisim的头文件和库文件,以及cmake文件安装到<code>/usr/local</code>文件夹下，这样后续使用就无需使用<code>--CMAKE_PREFIX_PATH</code>指定路径了。</p>
<h2 id="Raisim目录结构"><a href="#Raisim目录结构" class="headerlink" title="Raisim目录结构"></a>Raisim目录结构</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Name</span><br><span class="line">----</span><br><span class="line">cmake       <span class="comment"># cmake文件</span></span><br><span class="line">DEVELOPERS_ONLY</span><br><span class="line">docs        <span class="comment"># 文档</span></span><br><span class="line">examples    <span class="comment"># 例子</span></span><br><span class="line">raisim      <span class="comment"># raisim库二进制文件和头文件</span></span><br><span class="line">raisimGymTorch <span class="comment"># raisimGymTorch库和实例，用于和gym，以及pytorch配合使用</span></span><br><span class="line">raisimMatlab</span><br><span class="line">raisimPy    <span class="comment"># raisim的python接口</span></span><br><span class="line">raisimUnity <span class="comment"># 基于unity3D的仿真器</span></span><br><span class="line">raisimUnityOpengl <span class="comment"># 基于unity3D的仿真器，使用opengl渲染（linux下使用）</span></span><br><span class="line">rsc         <span class="comment"># 资源文件，主要是例子里的各种模型文件</span></span><br><span class="line">thirdParty  <span class="comment"># 第三方库，包括了Eigen和pybind11（共raisimGymTorch使用）</span></span><br><span class="line">CMakeLists.txt</span><br><span class="line">COPYING</span><br><span class="line">LICENSE.md</span><br><span class="line">package.xml</span><br><span class="line">README.md</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Raisim激活"><a href="#Raisim激活" class="headerlink" title="Raisim激活"></a>Raisim激活</h2><p>激活部分建议参阅官方文档的激活章节<a target="_blank" rel="noopener" href="https://raisim.com/sections/License.html">https://raisim.com/sections/License.html</a>, 由于raisim使用了Google Doc来填写申请，因此可能需要一些神奇工具才能打开网页。注意申请学术账户可以使用自己的google账户来申请，但是后续需要填写学校邮箱，激活码将发给学校邮箱内。学术账户最多可以申请10个，应该够用了。</p>
<p>将通过电子邮件收到的激活密钥重命名为 activation.raisim。将该文件保存在 <code>&lt;YOUR-HOME-DIR&gt;/.raisim/</code> 中。在 Linux 和 Mac 中，这是<code>/home/&lt;YOUR-USERNAME&gt;/.raisim/</code>。在 Windows 中，这是 <code>C/Users/&lt;YOUR-USERNAME&gt;/.raisim/</code>（您可能不使用 C 作为主目录）。</p>
<h1 id="Raisim的Visualizers"><a href="#Raisim的Visualizers" class="headerlink" title="Raisim的Visualizers"></a>Raisim的Visualizers</h1><p>Raisim目前包含3个Visualizers，分别是raisimUnity，RaisimUnreal，和RaisimOgre。</p>
<ul>
<li>如果你只在Linux上工作，并且你想自定义可视化工具 - RaisimOgre。</li>
<li>如果您想要一个适用于所有操作系统的简单解决方案 - RaisimUnity。</li>
<li>如果你只有一个集成的GPU，并且你在Linux上工作 - RaisimUnityOpenGL。</li>
<li>如果您想要最通用的解决方案，如果您想为出版物提供良好的图形，或者如果您在强化学习项目中使用视觉数据 – RaisimUnreal。</li>
</ul>
<p>本文测试后认为raisimUnity效果最好，因此本文主要介绍raisimUnity的使用。RaisimUnity安装在raisimUnity文件夹下，可以直接打开使用。</p>
<p><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/1.png"></p>
<p>在仿真器运行后(后续讲解如何使用<code>Raisim::Server</code>类建立服务端)点击连接就可以查看仿真了，默认端口号是8080，支持连接到远程仿真器。仿真时可以使用键盘<code>QWEASD</code>按钮和鼠标控制视角。下面总结一下仿真过程中会遇到的一些问题。</p>
<h2 id="Visualizers遇到的坑"><a href="#Visualizers遇到的坑" class="headerlink" title="Visualizers遇到的坑"></a>Visualizers遇到的坑</h2><ul>
<li>首先遇到的坑是模型资源加载失败，这个问题有时候会出现有时候又不会出现，坑了我很久，尝试过修改模型里的资源文件为绝对路径等方法，但是都没有解决。<strong>最后发现在RaisimUnity中可以指定模型路径，只需要在这里面添加模型的文件夹就可以解决这个问题了。</strong> 该问题在访问远程仿真器时必然会出现，因此需要注意。</li>
</ul>
<p><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/2.png"></p>
<ul>
<li><p>网络防火墙问题，如果你的电脑上有防火墙，那么需要将raisimUnity添加到防火墙的白名单中，否则会导致无法连接到远程仿真器，在Windows上列入白名单后仍可能会出现问题，建议重启或者关闭防火墙后使用。</p>
</li>
<li><p>wslg问题，如果使用的是wsl运行仿真器，那么请不要尝试在wslg中运行RaisimUnity，wslg的图形对3D类应用程序支持欠佳（包括ros的rviz也是）（关闭wslg的缩放会缓解该问题，wslg目前尚不支持vulkan API, 对OpenGL支持还行），会导致RaisimUnity无法正常运行。建议还是在Windows上运行Visualizers，将wsl视为远端服务器。</p>
</li>
</ul>
<h1 id="Raisim的API"><a href="#Raisim的API" class="headerlink" title="Raisim的API"></a>Raisim的API</h1><p>Raisim的API文档可以在<a target="_blank" rel="noopener" href="https://raisim.com/">https://raisim.com/</a>查看，这里简单介绍一下Raisim的API。</p>
<h2 id="World类"><a href="#World类" class="headerlink" title="World类"></a>World类</h2><p>World类是Raisim仿真器的核心类，所有的仿真都是在World类中进行的。所有在同一个World对象下的物体支持碰撞检查。World类可以使用XML文件来初始化，也可以使用代码来初始化。World类也可以使用MJCF(MuJoCo格式)来初始化，<strong>但是实际测试效果不好，不建议使用。</strong> 可以将Objects类等注册到World类中来仿真物体的运动和设置摩擦力，弹性形变等属性。</p>
<p>World类中使用<code>integrate()</code>方法来完成一个时间片的更新。</p>
<blockquote>
<p>integrate the world It is equivalent to call <code>integrate1(); integrate2();</code>.<br><code>integrate1()</code> performs 1) deletion contacts from previous time step 2) collision detection 3) register contacts to each body 4) calls “preContactSolverUpdate1()” of each object.<br><code>integrate2()</code> performs 1) calls “preContactSolverUpdate2()” of each body 2) run collision solver 3) calls “integrate” method of each object.</p>
</blockquote>
<h2 id="Object类"><a href="#Object类" class="headerlink" title="Object类"></a>Object类</h2><p>有三种可用的类型。</p>
<ul>
<li>DYNAMICS：可以有速度，质量有限（如待仿真的机器人）。</li>
<li>KINEMATIC：可以有速度，有无限的质量（例如，传送带）。</li>
<li>STATIC：不能有速度，有无限的质量（例如，墙壁）。<br>这些物体可以指定为SingleBodyObject或者ArticulatedSystem。前者表示一个单一的物体如球，立方体等，而后者是一个带有铰接的系统，可以从URDF文件读取。可以进行逆向运动学解算或者使用PD控制器控制，具体请参阅API手册。</li>
</ul>
<h2 id="材质系统"><a href="#材质系统" class="headerlink" title="材质系统"></a>材质系统</h2><p>在RaiSim中，所有材料属性都与材料对相关联。目前，RaiSim中使用了五种材料属性。</p>
<blockquote>
<ul>
<li><strong>Coefficient of friction ($\mu\ge 0$)</strong>: This defines how much friction is applied between the two materials.</li>
<li><strong>Coefficient of restitution ($c_r\ge 0$)</strong>: How bouncy the material pair is.</li>
<li><strong>Restitution Threshold ($r_{th}\ge 0$)</strong>: If the impact velocity is smaller than this number, objects do not bounce off.</li>
<li><strong>Coefficient of static friction ($\mu_{s}\ge \mu$)</strong>: If specified, it defines how much friction is applied when the relative velocity between the contact points is very small. By default, it is the same as the coefficient of friction.</li>
<li><strong>Velocity threshold for static friction ($v_s \ge 0$)</strong>: Must be specified if the coefficient of static friction is specified. If the relative velocity is bigger than this value, than static friction is not used. Otherwise, the effective coefficient of friction is interpolated between the two coefficients.</li>
</ul>
</blockquote>
<p><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/materials.png"></p>
<p><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/materials.gif"></p>
<h2 id="Server类"><a href="#Server类" class="headerlink" title="Server类"></a>Server类</h2><p>使用<code>Raisim::Server</code>类可以创立服务器供Visualizers监听。使用<code>inline explicit RaisimServer(World *world)</code>方法将World类绑定到server上，之后使用<code>inline explicit RaisimServer(World*world)</code>方法即可开始监听。<strong>注意Server与Visualizers的通信和实际仿真过程发生在不同的线程上，因此需要一些锁来进行线程同步</strong>。</p>
<p>例如在更新World的过程中使用Server类的<code>lockVisualizationServerMutex(),unlockVisualizationServerMutex()</code>来加锁防止在更新World时读取数据。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//节选自 examples/server/balls.cpp</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;; i++) &#123;</span><br><span class="line">    <span class="built_in">RS_TIMED_LOOP</span>(<span class="built_in">int</span>(world.<span class="built_in">getTimeStep</span>()*<span class="number">1e6</span>))</span><br><span class="line">    server.<span class="built_in">lockVisualizationServerMutex</span>(); <span class="comment">//加锁</span></span><br><span class="line">    <span class="keyword">if</span> (i % interval == <span class="number">0</span> &amp;&amp; j &lt; numBalls) &#123;</span><br><span class="line">      <span class="keyword">auto</span>* ball = world.<span class="built_in">addSphere</span>(<span class="number">0.1</span>, <span class="number">1.0</span>);</span><br><span class="line">      ball-&gt;<span class="built_in">setPosition</span>(<span class="number">0</span>, <span class="number">-2</span>, <span class="number">0.8</span>);</span><br><span class="line">      ball-&gt;<span class="built_in">setVelocity</span>(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      ball-&gt;<span class="built_in">setAppearance</span>(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">      j++;</span><br><span class="line">    &#125;</span><br><span class="line">    server.<span class="built_in">applyInteractionForce</span>();  <span class="comment">//更新交互力，这句话不能删除，否则会出问题</span></span><br><span class="line">    world.<span class="built_in">integrate</span>(); <span class="comment">//更新World</span></span><br><span class="line">    server.<span class="built_in">unlockVisualizationServerMutex</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>或者使用<code>integrateWorldThreadSafe()</code>方法来更新World，该方法会自动加锁。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//节选自 examples/server/meshes.cpp</span></span><br><span class="line"> <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">RS_TIMED_LOOP</span>(<span class="built_in">int</span>(world.<span class="built_in">getTimeStep</span>()*<span class="number">1e6</span>))</span><br><span class="line">    server.<span class="built_in">integrateWorldThreadSafe</span>();</span><br><span class="line">    <span class="comment">//相当于执行如下代码</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    server.lockVisualizationServerMutex();</span></span><br><span class="line"><span class="comment">    server.applyInteractionForce();</span></span><br><span class="line"><span class="comment">    world.integrate();</span></span><br><span class="line"><span class="comment">    server.unlockVisualizationServerMutex();</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>本文初步介绍了Raisim的安装，配置，以及API，以及如何使用Raisim仿真器来进行强化学习仿真环境的搭建。Raisim的API文档可以在<a target="_blank" rel="noopener" href="https://raisim.com/">https://raisim.com/</a>查看，本文简单介绍一下Raisim的API，本文还介绍了raisimUnity的使用。在下一篇文章中，将介绍如何使用RaisimGymTorch配合stable_baseline3, gymnasium(Gym), Pytorch等来搭建强化学习仿真环境。</p>
<hr>
<p>EOF</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://blog.zzshub.cn">Zishun Zhou</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://blog.zzshub.cn/2023/07/26/DRL_RaisimInstall/">https://blog.zzshub.cn/2023/07/26/DRL_RaisimInstall/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.zzshub.cn" target="_blank">ZZSHUB</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/">强化学习</a><a class="post-meta__tags" href="/tags/%E4%BB%BF%E7%9C%9F%E5%99%A8/">仿真器</a></div><div class="post_share"><div class="social-share" data-image="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/logo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/wechatpay.JPG" target="_blank"><img class="post-qr-code-img" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/wechatpay.JPG" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/26/DRL_RaisimGymTorch/" title="强化学习仿真器Raisim进行深度强化学习的初步尝试"><img class="cover" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/logo.png" onerror="onerror=null;src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">强化学习仿真器Raisim进行深度强化学习的初步尝试</div></div></a></div><div class="next-post pull-right"><a href="/2023/05/20/Image_Segmentation_via_Spectral_Clustering/" title="Image Segmentation via Spectral Clustering"><img class="cover" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog%2FShapes.jpg" onerror="onerror=null;src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Image Segmentation via Spectral Clustering</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/07/26/DRL_RaisimGymTorch/" title="强化学习仿真器Raisim进行深度强化学习的初步尝试"><img class="cover" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/RaisimInstall/logo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-26</div><div class="title">强化学习仿真器Raisim进行深度强化学习的初步尝试</div></div></a></div><div><a href="/2024/06/21/DRL_LeggedgymInstall/" title="强化学习仿真器Isaac Gym的安装与配置"><img class="cover" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/DRL_installIsaacgym/cover.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-21</div><div class="title">强化学习仿真器Isaac Gym的安装与配置</div></div></a></div><div><a href="/2024/05/21/start_rl/" title="机器人控制中的强化学习极简入门指南"><img class="cover" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/start_rl/cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-21</div><div class="title">机器人控制中的强化学习极简入门指南</div></div></a></div><div><a href="/2024/06/25/DRL_LeggedgymCartpole2/" title="强化学习仿真环境Legged Gym的初步使用——训练一个二阶倒立摆"><img class="cover" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/DRL_cartpole2/cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-25</div><div class="title">强化学习仿真环境Legged Gym的初步使用——训练一个二阶倒立摆</div></div></a></div><div><a href="/2023/10/14/conclusion-of-entropy/" title="机器学习中的各种熵总结"><img class="cover" src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/conclusion_of_entropy/th.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-14</div><div class="title">机器学习中的各种熵总结</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/zzslogo.jpg" onerror="this.onerror=null;this.src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.gif'" alt="avatar"/></div><div class="author-info__name">Zishun Zhou</div><div class="author-info__description">周子顺</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ZzzzzzS"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ZzzzzzS" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:zhouzishun@mail.zzshub.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">这个人很懒，他什么也没留下</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E4%BB%BF%E7%9C%9F%E5%99%A8Raisim%E7%9A%84%E5%AE%89%E8%A3%85%EF%BC%8C%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%B8%8E%E5%88%9D%E6%AD%A5%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">强化学习仿真器Raisim的安装，配置，与初步使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Raisim%E7%AE%80%E4%BB%8B%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">Raisim简介和安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Raisim%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">2.1.</span> <span class="toc-text">Raisim目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Raisim%E6%BF%80%E6%B4%BB"><span class="toc-number">2.2.</span> <span class="toc-text">Raisim激活</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Raisim%E7%9A%84Visualizers"><span class="toc-number">3.</span> <span class="toc-text">Raisim的Visualizers</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Visualizers%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91"><span class="toc-number">3.1.</span> <span class="toc-text">Visualizers遇到的坑</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Raisim%E7%9A%84API"><span class="toc-number">4.</span> <span class="toc-text">Raisim的API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#World%E7%B1%BB"><span class="toc-number">4.1.</span> <span class="toc-text">World类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">Object类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%90%E8%B4%A8%E7%B3%BB%E7%BB%9F"><span class="toc-number">4.3.</span> <span class="toc-text">材质系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Server%E7%B1%BB"><span class="toc-number">4.4.</span> <span class="toc-text">Server类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/25/DRL_LeggedgymCartpole2/" title="强化学习仿真环境Legged Gym的初步使用——训练一个二阶倒立摆"><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/DRL_cartpole2/cover.jpg" onerror="this.onerror=null;this.src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.jpg'" alt="强化学习仿真环境Legged Gym的初步使用——训练一个二阶倒立摆"/></a><div class="content"><a class="title" href="/2024/06/25/DRL_LeggedgymCartpole2/" title="强化学习仿真环境Legged Gym的初步使用——训练一个二阶倒立摆">强化学习仿真环境Legged Gym的初步使用——训练一个二阶倒立摆</a><time datetime="2024-06-25T04:00:00.000Z" title="发表于 2024-06-25 12:00:00">2024-06-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/21/DRL_LeggedgymInstall/" title="强化学习仿真器Isaac Gym的安装与配置"><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/DRL_installIsaacgym/cover.png" onerror="this.onerror=null;this.src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.jpg'" alt="强化学习仿真器Isaac Gym的安装与配置"/></a><div class="content"><a class="title" href="/2024/06/21/DRL_LeggedgymInstall/" title="强化学习仿真器Isaac Gym的安装与配置">强化学习仿真器Isaac Gym的安装与配置</a><time datetime="2024-06-21T04:00:00.000Z" title="发表于 2024-06-21 12:00:00">2024-06-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/21/start_rl/" title="机器人控制中的强化学习极简入门指南"><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/start_rl/cover.jpg" onerror="this.onerror=null;this.src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.jpg'" alt="机器人控制中的强化学习极简入门指南"/></a><div class="content"><a class="title" href="/2024/05/21/start_rl/" title="机器人控制中的强化学习极简入门指南">机器人控制中的强化学习极简入门指南</a><time datetime="2024-05-21T04:00:00.000Z" title="发表于 2024-05-21 12:00:00">2024-05-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/14/conclusion-of-entropy/" title="机器学习中的各种熵总结"><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/conclusion_of_entropy/th.jpg" onerror="this.onerror=null;this.src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.jpg'" alt="机器学习中的各种熵总结"/></a><div class="content"><a class="title" href="/2023/10/14/conclusion-of-entropy/" title="机器学习中的各种熵总结">机器学习中的各种熵总结</a><time datetime="2023-10-14T10:40:13.000Z" title="发表于 2023-10-14 18:40:13">2023-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/30/wslgperformace/" title="WSL中的GPU原理总结"><img src="https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/wslgpuperformance/logo.png" onerror="this.onerror=null;this.src='https://zzshubimage-1253829354.cos.ap-beijing.myqcloud.com/blog/404.jpg'" alt="WSL中的GPU原理总结"/></a><div class="content"><a class="title" href="/2023/08/30/wslgperformace/" title="WSL中的GPU原理总结">WSL中的GPU原理总结</a><time datetime="2023-08-30T06:12:32.000Z" title="发表于 2023-08-30 14:12:32">2023-08-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2024 By Zishun Zhou</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">喵喵喵喵喵</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.13.0/js/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.13.0/js/main.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.13.0/js/tw_cn.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.umd.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.2.0/instantpage.min.js" type="module"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/node-snackbar/0.1.16/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: 'Ov23li0kkKyhMGCSCF8C',
      clientSecret: 'e6803156ae2eb0273961046aaa938b39152eb81a',
      repo: 'ZzzzzzS.github.io',
      owner: 'ZzzzzzS',
      admin: ['ZzzzzzS'],
      id: '0cd67eb6b30c15c549262d00ffaf1403',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.css')
      await getScript('https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdnjs.cloudflare.com/ajax/libs/butterfly-extsrc/1.1.3/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-butterfly/4.13.0/js/search/local-search.min.js"></script></div></div><script src="https://cdn.jsdelivr.net/npm/live2d-widget@^3.1.3/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"https://cdn.jsdelivr.net/npm/live2d-widget-model-shizuku/assets/shizuku.model.json"},"display":{"position":"left","hOffset":60,"vOffset":0,"width":150,"height":300},"mobile":{"show":false},"react":{"opacity":1},"dialog":{"enable":true,"hitokoto":true},"log":false});</script></body></html>